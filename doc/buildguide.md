# Build Guide

![picot_o44_main00](/images/main_00.jpg)

picot_o44のビルドガイドになります。  

picot_o44は、マイコン+トラックボールモジュールであるpicot5400を活用したオーソリニア40%キーボードです。中央のトラックボールは25mm、34mmどちらにも対応可能です。専用の3Dプリントケースが用意されています。  
まず始めにこのビルドガイドを最後までよく読み、必要なものを揃えた上で組み立てに取り掛かってください。


## 部品
### キット付属品

|名前|数|備考|
|---|---|---|
|メインPCB|1枚||
|スイッチプレート|1枚||
|picot5400|1枚||
|Unified Daughter Board|1個||
|マウスセンサー（PMW3360）|1個||
|JSTケーブル|1本||
|FFC|1本||
|M2スペーサー 3.5mm|16個||
|M2ねじ 3mm|24本||
|M2ねじ 5mm|8本||
|ゴム脚|4個||
|ベアリングローラー|3個||
|ステンレス丸棒|3本||
|シリコンチューブ（細）|1本||
|シリコンチューブ（太）|1本||
|マグネット|8個||
|3Dプリントケース|1個||
|3Dプリントボールケース（ベース・カバー）|各1個||



### キット以外に必要なもの

|名前|数|備考|
|---|---|---|
|キースイッチ|最大44個|MX互換|
|キーキャップ|最大44個|MX互換|
|2Uスタビライザー|0～3個||
|ロータリーエンコーダ+ノブ（直径18mm以下）|0～2個|オプション|
|トラックボール（34mm or 25mmボール）|1個||
|USB-TypeCケーブル|1本||


## 組み立て
### 部品確認

  まずはキット付属品に記載されたパーツが揃っているか確認ください。  
  その他上述の「キット以外に必要なもの」を揃えた上で組み立てに取り掛かってください。

  - タブ付きPCBの場合にはタブを割って切り離し、切断面を軽くヤスリがけしてください。


### picot5400

  まず[picot5400のビルドガイド](https://github.com/aki27kbd/picot5400/blob/main/doc/buildguide.md)を確認し、picot5400関係のはんだ付けと組み立てを行ってください。  

### メインPCB

  スイッチソケットがはんだ付けされていない基板の場合、ソケットをはんだ付けしてください。  
  ロータリーエンコーダを取り付ける場合はこの段階ではんだ付けを行ってください。
  ![picot_o44_bg_pcb_1](/images/bg_pcb_1.jpg)  

  スタビライザーを取り付ける場合はこのタイミングでメインPCBに固定します。

  スイッチプレートにスイッチを取り付けながら、PCBに差し込んでいきます。キースイッチの脚が曲がってしまわないように注意してください。
  ![picot_o44_bg_pcb_2](/images/bg_pcb_2.jpg)  

  太い方のシリコンチューブを、4mm程度の長さで8本切ります。ハサミなどで簡単に切れますが、できるだけ切断面が真っすぐになるように注意してください。
  ![picot_o44_bg_pcb_3](/images/bg_pcb_3.jpg)  

  スペーサーを切り出したシリコンチューブの中に通します。
  ![picot_o44_bg_pcb_4](/images/bg_pcb_4.jpg)  

  シリコンチューブに通したスペーサーを、スイッチプレートとPCBの間に8か所差し込み、上下から3mmねじでねじ止めします。
  ![picot_o44_bg_pcb_5](/images/bg_pcb_5.jpg)  

  8か所すべてにスペーサーを通すことで剛性が増し硬めの打鍵感になります。中央4か所のスペーサーを外し、四隅だけにスペーサーを設置することで柔らかめの打鍵感になります。お好みで調整してみてください。

### 組み立て

  まずケースにドーターボードを取り付けます。

  ケース裏面から3mmねじでスペーサーを4か所固定します。
  ![picot_o44_bg_assembly_1](/images/bg_assembly_1.jpg)

  ドーターボードをスペーサーの上に置き、上から3mmねじでねじ止めします。  
  ![picot_o44_bg_assembly_2](/images/bg_assembly_2.jpg)

  picot5400を中央に置きます。  
  ![picot_o44_bg_assembly_3](/images/bg_assembly_3.jpg)

  picot5400の四隅にスペーサーを置き、下から5mmねじでねじ止めします。
  ![picot_o44_bg_assembly_4](/images/bg_assembly_4.jpg)

  ボールケース（ベース）を置き、5mmねじで固定します。  
  ![picot_o44_bg_assembly_5](/images/bg_assembly_5.jpg)

  フラットケーブルを折り曲げ、picot5400のコネクタに取り付けます。  
  ![picot_o44_bg_assembly_6](/images/bg_assembly_6.jpg)  

  ケーブルの反対側をメインPCBのコネクタに接続します。
  ![picot_o44_bg_assembly_7](/images/bg_assembly_7.jpg)  

  メインPCBをゆっくりとケースに入れていきます。外周のシリコンチューブが引っかかる場合は指でやさしく押し込んでください。
  ![picot_o44_bg_assembly_8](/images/bg_assembly_8.jpg)  

  キーキャップ、トラックボール、ロータリーエンコーダノブ等を付けて完成です。
  ![picot_o44_bg_assembly_9](/images/bg_assembly_9.jpg)  


### ファームウェア

  デフォルトのファームが書き込まれた状態でお届けしています。ご自分でファームを書き込む場合、下記手順の通り実行してください。

  - picot5400のBOOTボタンを押しながらRESETボタンを押し、ブートローダーモードに入ります。
  - その状態でRPI-RP2というドライブに[.uf2](https://github.com/aki27kbd/picot_o44/blob/main/firmware/aki27_picot_o44_vial.uf2)ファイルをドラッグ&ドロップすることでファームが書き込まれます。　　

  キーマップは[vial](https://vial.rocks/)から更新可能です。  
  トラックボールの動作は後述のセンサー基板を組み立ててから行ってください。  
  ![vial](/images/vial.jpg)

  デフォルトのファームウェアでは自動マウスレイヤー機能がオンになっています。この機能では、トラックボールを動かすと自動的にマウスレイヤー（レイヤー4）に移動することが可能です。カスタムキーコード（`AM_TOG`）を押すことで自動マウスレイヤー機能のオンオフを切り替えられます。

  ソースコードは[こちら](https://github.com/aki27kbd/vial-qmk/tree/vial/keyboards/aki27/picot_o44)を参照ください。      


## カスタムキーコード

  トラックボールの操作に関していくつかカスタムキーコードを設定することが可能です。（SCRL_MOはレイヤー4でのみ有効）

  Keycode   |Description
  ---------|-----------
  `CPI_SW`  |トラックボールのCPIを変更します。デフォルトのファームウェアでは、押すたびに200→400→800→1600→3200→200…という順番でCPIが変わります。
  `SCRL_SW` |スクロールモードにおけるセンサーの感度を変更します。数値が大きいほどスクロール量が小さくなります。
  `ROT_R15` |マウスセンサーのＹ軸を時計回りに15度回転させます。
  `ROT_L15` |マウスセンサーのＹ軸を反時計回りに15度回転させます。
  `SCRL_MO` |押されている間スクロールモードになります。（デフォルトファームではレイヤー4でのみ有効）
  `SCRL_TO` |押すたびにスクロールモードとマウスモードを切り替えます。（デフォルトファームでは無効）
  `SCRL_IN` |スクロール方向を反転させます。
  `AM_TOG` |自動マウスレイヤー切り替えのオンオフを切り替えます。

  vialでカスタムキーコードを設定する場合はUserタブ下のカスタムキーコードを用いて設定することが可能です。  
  ![CustomKeycode_rev](/images/bg_customkeycode.jpg)


## 終わりに
何かトラブルがあれば[Twitterアカウント](https://twitter.com/aki27kbd)までご連絡ください。

また、完成写真をSNSにアップいただけるととても励みになります。（アップするのがはばかられる方はDMで直接送りつけていただいても構いません。）

ハッシュタグは #picot_o44 です。
